<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fernando Lapa - F1</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: #1a1a1a;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            overflow-x: hidden;
            position: relative;
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }

        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            color: #ff1a1a;
            text-shadow: 0 0 25px rgba(255, 26, 26, 0.9), 0 0 50px rgba(255, 26, 26, 0.5);
            font-size: 3.8em;
            margin-bottom: 60px;
            letter-spacing: 5px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            animation: neonPulse 2s ease-in-out infinite alternate;
        }

        @keyframes neonPulse {
            from { text-shadow: 0 0 15px rgba(255, 26, 26, 0.7), 0 0 30px rgba(255, 26, 26, 0.4); }
            to { text-shadow: 0 0 25px rgba(255, 26, 26, 1), 0 0 50px rgba(255, 26, 26, 0.6); }
        }

        .flag-br {
            width: 40px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .flag-br:hover {
            transform: scale(1.2) rotate(5deg);
        }

        .f1-logo {
            width: 80px;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7));
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .f1-logo:hover {
            transform: scale(1.2) rotate(-5deg);
        }

        .form-container {
            background: linear-gradient(145deg, rgba(20, 20, 30, 0.95), rgba(40, 40, 50, 0.95));
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.9), inset 0 0 20px rgba(255, 26, 26, 0.5);
            margin-bottom: 60px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(12px);
            animation: slideIn 1s ease-out;
        }

        .form-container:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.95), inset 0 0 25px rgba(255, 26, 26, 0.6);
        }

        .form-container h2 {
            font-family: 'Orbitron', sans-serif;
            color: #00e6e6;
            text-shadow: 0 0 15px rgba(0, 230, 230, 0.8);
            margin-bottom: 30px;
            font-size: 2em;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .form-container select, .form-container input[type="number"] {
            width: 100%;
            padding: 16px;
            margin: 15px 0;
            border: 2px solid rgba(255, 26, 26, 0.3);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(30, 30, 40 cushion: 0.9);
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .form-container select:focus, .form-container input[type="number"]:focus {
            border-color: #ff1a1a;
            background: rgba(40, 40, 50, 0.95);
            box-shadow: 0 0 15px rgba(255, 26, 26, 0.7);
            transform: scale(1.03);
        }

        .form-container label {
            margin: 15px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #d0d0d0;
            transition: color 0.3s ease;
        }

        .form-container label:hover {
            color: #ffffff;
        }

        .form-container button {
            background: linear-gradient(45deg, #ff1a1a, #ff4d4d);
            color: #ffffff;
            border: none;
            padding: 16px 40px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            transition: all 0.4s ease;
            width: 100%;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 26, 26, 0.5);
        }

        .form-container button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.6s;
        }

        .form-container button:hover::after {
            left: 100%;
        }

        .form-container button:hover {
            background: linear-gradient(45deg, #cc0000, #ff3333);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 26, 26, 0.8);
        }

        .table-container {
            background: linear-gradient(145deg, rgba(20, 20, 30, 0.95), rgba(40, 40, 50, 0.95));
            border-radius: 25px;
            overflow-x: auto;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.9);
            margin-bottom: 60px;
            backdrop-filter: blur(12px);
            animation: slideIn 1.2s ease-out 0.2s;
            border: 2px solid #ff1a1a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #ffffff;
        }

        th, td {
            padding: 20px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 16px;
        }

        th {
            background: linear-gradient(45deg, #ff1a1a, #ff4d4d);
            color: #ffffff;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        tr {
            cursor: pointer;
            transition: all 0.4s ease;
        }

        tr:nth-child(even) {
            background: rgba(40, 40, 50, 0.7);
        }

        tr:hover {
            background: linear-gradient(90deg, rgba(255, 26, 26, 0.2), rgba(0, 230, 230, 0.2));
            transform: translateX(10px);
        }

        tr:first-child td:nth-child(4) {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #000;
            font-weight: bold;
        }

        tr:nth-child(2) td:nth-child(4) {
            background: linear-gradient(45deg, #c0c0c0, #a0a0a0);
            color: #000;
        }

        tr:nth-child(3) td:nth-child(4) {
            background: linear-gradient(45deg, #cd7f32, #b87333);
            color: #000;
        }

        .flag {
            width: 32px;
            vertical-align: middle;
            margin-right: 12px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
            transition: transform 0.4s ease;
        }

        .flag:hover {
            transform: scale(1.2);
        }

        .delete-btn {
            background: linear-gradient(45deg, #cc0000, #ff3333);
            color: #ffffff;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.4s ease;
        }

        .delete-btn:hover {
            background: linear-gradient(45deg, #aa0000, #cc0000);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 26, 26, 0.8);
        }

        .delete-btn i {
            margin-right: 8px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .stats-card {
            background: linear-gradient(145deg, rgba(20, 20, 30, 0.95), rgba(40, 40, 50, 0.95));
            color: #ffffff;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.9), inset 0 0 20px rgba(0, 230, 230, 0.5);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(12px);
            animation: slideIn 1.4s ease-out 0.4s;
            position: relative;
            overflow: hidden;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 26, 26, 0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .stats-card:hover::before {
            opacity: 1;
        }

        .stats-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.95), inset 0 0 25px rgba(0, 230, 230, 0.6);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-card h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00e6e6;
            text-shadow: 0 0 15px rgba(0, 230, 230, 0.8);
            margin-bottom: 25px;
            font-size: 2em;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .stats-card p {
            margin: 15px 0;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .stats-card p:hover {
            color: #ff1a1a;
            transform: translateX(5px);
        }

        .stats-card p i {
            color: #ff1a1a;
            font-size: 1.5em;
            transition: transform 0.4s ease;
        }

        .stats-card p:hover i {
            transform: scale(1.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeInModal 0.5s ease-out;
        }

        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'), linear-gradient(145deg, #1a1a1a, #2a2a2a);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.9), inset 0 0 20px rgba(255, 26, 26, 0.5);
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
            backdrop-filter: blur(12px);
            animation: accelerateIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border: 2px solid #ff1a1a;
            overflow: hidden;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 26, 26, 0.2) 50%, transparent);
            animation: ledFlash 3s infinite;
            pointer-events: none;
        }

        @keyframes ledFlash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        @keyframes accelerateIn {
            from { transform: scale(0.8) translateY(50px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .modal-content h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00e6e6;
            text-shadow: 0 0 15px rgba(0, 230, 230, 0.8);
            font-size: 2.2em;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
            animation: ledBlink 1.5s infinite;
        }

        @keyframes ledBlink {
            0%, 100% { text-shadow: 0 0 15px rgba(0, 230, 230, 0.8); }
            50% { text-shadow: 0 0 25px rgba(0, 230, 230, 1); }
        }

        .modal-content .gp-flag {
            width: 80px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(255, 26, 26, 0.7);
            animation: waveFlag 2s ease-in-out infinite;
        }

        @keyframes waveFlag {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(5deg); }
        }

        .modal-content .stats-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        .modal-content .stats-list p {
            background: linear-gradient(145deg, rgba(40, 40, 50, 0.95), rgba(60, 60, 70, 0.95));
            padding: 10px;
            border-radius: 10px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(255, 26, 26, 0.3);
        }

        .modal-content .stats-list p:hover {
            color: #ff1a1a;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7), inset 0 0 15px rgba(255, 26, 26, 0.5);
        }

        .modal-content .stats-list p i {
            color: #ff1a1a;
            font-size: 1.6em;
            transition: transform 0.4s ease;
        }

        .modal-content .stats-list p:hover i {
            transform: rotate(360deg);
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(45deg, #333, #555);
            color: #ff1a1a;
            border: 2px solid #ff1a1a;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
            box-shadow: 0 0 10px rgba(255, 26, 26, 0.5);
        }

        .close-btn:hover {
            background: linear-gradient(45deg, #222, #444);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 26, 26, 0.8);
        }

        @media (max-width: 768px) {
            body {
                padding: 30px;
            }

            h1 {
                font-size: 3em;
                margin-bottom: 50px;
            }

            .flag-br {
                width: 36px;
            }

            .f1-logo {
                width: 70px;
            }

            .form-container, .stats-card {
                padding: 30px;
            }

            .form-container select, .form-container input[type="number"] {
                font-size: 15px;
            }

            .form-container label {
                font-size: 15px;
            }

            .form-container button {
                font-size: 15px;
                padding: 14px;
            }

            th, td {
                padding: 15px;
                font-size: 14px;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 30px;
            }

            .modal-content .gp-flag {
                width: 60px;
            }

            .modal-content h3 {
                font-size: 1.8em;
            }

            .modal-content .stats-list p {
                font-size: 1.2em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2.5em;
                margin-bottom: 40px;
            }

            .flag-br {
                width: 32px;
            }

            .f1-logo {
                width: 60px;
            }

            .form-container, .stats-card {
                padding: 25px;
            }

            .form-container h2, .stats-card h3 {
                font-size: 1.8em;
            }

            th, td {
                padding: 12px;
                font-size: 13px;
            }

            .flag {
                width: 28px;
            }

            .delete-btn {
                padding: 10px 14px;
                font-size: 13px;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .modal-content .gp-flag {
                width: 50px;
            }

            .modal-content h3 {
                font-size: 1.6em;
                flex-direction: column;
                gap: 10px;
            }

            .modal-content .stats-list p {
                font-size: 1.1em;
                padding: 8px;
            }

            .modal-content .stats-list {
                grid-template-columns: 1fr;
            }

            .close-btn {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="container">
        <h1>
            <img src="https://flagcdn.com/w20/br.png" class="flag-br" alt="Bandeira do Brasil">
            Fernando Lapa - F1
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/33/F1.svg" class="f1-logo" alt="Fórmula 1 Logo">
        </h1>
        <div class="form-container">
            <h2><i class="fas fa-flag-checkered"></i> Adicionar Resultado de Corrida</h2>
            <select id="temporada">
                <option value="2023">2023</option>
                <option value="2024" selected>2024</option>
            </select>
            <select id="grandePremio"></select>
            <input type="number" id="posicao" placeholder="Posição (1-20)" min="1" max="20">
            <label><input type="checkbox" id="pole"> <i class="fas fa-tachometer-alt"></i> Pole Position</label>
            <label><input type="checkbox" id="voltaMaisRapida"> <i class="fas fa-stopwatch"></i> Volta Mais Rápida</label>
            <label><input type="checkbox" id="grandSlam"> <i class="fas fa-trophy"></i> Grand Slam</label>
            <input type="number" id="titulos" placeholder="Títulos Mundiais (Manual)" min="0">
            <button id="adicionarResultadoBtn"><i class="fas fa-plus-circle"></i> Adicionar Resultado</button>
        </div>
        <h2><i class="fas fa-list"></i> Resultados das Corridas</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Temporada</th>
                        <th>Grande Prêmio</th>
                        <th>Data</th>
                        <th>Posição</th>
                        <th>Pole</th>
                        <th>Volta Mais Rápida</th>
                        <th>Grand Slam</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="resultadosBody"></tbody>
            </table>
        </div>
        <h2><i class="fas fa-chart-bar"></i> Estatísticas</h2>
        <div class="stats-container">
            <div class="stats-card" id="statsTemporada"></div>
            <div class="stats-card" id="carreiraStats"></div>
        </div>
    </div>

    <!-- Modal for GP Stats -->
    <div id="gpModal" class="modal">
        <div class="modal-content">
            <button class="close-btn"><i class="fas fa-times"></i></button>
            <h3 id="gpTitle"></h3>
            <div class="stats-list" id="gpStats"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: ['#ff1a1a', '#00e6e6'] },
                shape: { type: 'circle', stroke: { width: 0, color: '#000000' } },
                opacity: { value: 0.5, random: true, anim: { enable: true, speed: 1, opacity_min: 0.1 } },
                size: { value: 3, random: true, anim: { enable: true, speed: 4, size_min: 0.3 } },
                line_linked: { enable: false },
                move: { enable: true, speed: 6, direction: 'none', random: true, straight: false, out_mode: 'out' }
            },
            interactivity: {
                detect_on: 'canvas',
                events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
                modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
            },
            retina_detect: true
        });

        document.addEventListener("DOMContentLoaded", () => {
            const firebaseConfig = {
                apiKey: "AIzaSyA0OlEixa0paaC8w5vwXr3d8bdXHsTsk6Q",
                authDomain: "formula1-7ddf0.firebaseapp.com",
                projectId: "formula1-7ddf0",
                storageBucket: "formula1-7ddf0.firebasestorage.app",
                messagingSenderId: "1033180811650",
                appId: "1:1033180811650:web:9e315520430b36e4e8ff9b",
                measurementId: "G-Q8LEND18DW"
            };

            let db;
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log("Firebase inicializado com sucesso.");
            } catch (error) {
                console.error("Erro ao inicializar Firebase:", error);
                alert("Erro ao conectar com o banco de dados. Verifique o console.");
            }

            const countryFlags = {
                "Grande Prêmio do Bahrein": "https://flagcdn.com/w20/bh.png",
                "Grande Prêmio da Arábia Saudita": "https://flagcdn.com/w20/sa.png",
                "Grande Prêmio da Austrália": "https://flagcdn.com/w20/au.png",
                "Grande Prêmio do Azerbaijão": "https://flagcdn.com/w20/az.png",
                "Grande Prêmio de Miami": "https://flagcdn.com/w20/us.png",
                "Grande Prêmio de Mônaco": "https://flagcdn.com/w20/mc.png",
                "Grande Prêmio da Espanha": "https://flagcdn.com/w20/es.png",
                "Grande Prêmio do Canadá": "https://flagcdn.com/w20/ca.png",
                "Grande Prêmio da Áustria": "https://flagcdn.com/w20/at.png",
                "Grande Prêmio da Grã-Bretanha": "https://flagcdn.com/w20/gb.png",
                "Grande Prêmio da Hungria": "https://flagcdn.com/w20/hu.png",
                "Grande Prêmio da Bélgica": "https://flagcdn.com/w20/be.png",
                "Grande Prêmio dos Países Baixos": "https://flagcdn.com/w20/nl.png",
                "Grande Prêmio da Itália": "https://flagcdn.com/w20/it.png",
                "Grande Prêmio de Singapura": "https://flagcdn.com/w20/sg.png",
                "Grande Prêmio do Japão": "https://flagcdn.com/w20/jp.png",
                "Grande Prêmio do Catar": "https://flagcdn.com/w20/qa.png",
                "Grande Prêmio dos Estados Unidos": "https://flagcdn.com/w20/us.png",
                "Grande Prêmio do México": "https://flagcdn.com/w20/mx.png",
                "Grande Prêmio de São Paulo": "https://flagcdn.com/w20/br.png",
                "Grande Prêmio de Las Vegas": "https://flagcdn.com/w20/us.png",
                "Grande Prêmio de Abu Dhabi": "https://flagcdn.com/w20/ae.png",
                "Grande Prêmio da China": "https://flagcdn.com/w20/cn.png",
                "Grande Prêmio da Emília-Romanha": "https://flagcdn.com/w20/it.png"
            };

            const corridas = {
                "2023": [
                    { nome: "Grande Prêmio do Bahrein", data: "2023-03-05" },
                    { nome: "Grande Prêmio da Arábia Saudita", data: "2023-03-19" },
                    { nome: "Grande Prêmio da Austrália", data: "2023-04-02" },
                    { nome: "Grande Prêmio do Azerbaijão", data: "2023-04-30" },
                    { nome: "Grande Prêmio de Miami", data: "2023-05-07" },
                    { nome: "Grande Prêmio de Mônaco", data: "2023-05-28" },
                    { nome: "Grande Prêmio da Espanha", data: "2023-06-04" },
                    { nome: "Grande Prêmio do Canadá", data: "2023-06-18" },
                    { nome: "Grande Prêmio da Áustria", data: "2023-07-02" },
                    { nome: "Grande Prêmio da Grã-Bretanha", data: "2023-07-09" },
                    { nome: "Grande Prêmio da Hungria", data: "2023-07-23" },
                    { nome: "Grande Prêmio da Bélgica", data: "2023-07-30" },
                    { nome: "Grande Prêmio dos Países Baixos", data: "2023-08-27" },
                    { nome: "Grande Prêmio da Itália", data: "2023-09-03" },
                    { nome: "Grande Prêmio de Singapura", data: "2023-09-17" },
                    { nome: "Grande Prêmio do Japão", data: "2023-09-24" },
                    { nome: "Grande Prêmio do Catar", data: "2023-10-08" },
                    { nome: "Grande Prêmio dos Estados Unidos", data: "2023-10-22" },
                    { nome: "Grande Prêmio do México", data: "2023-10-29" },
                    { nome: "Grande Prêmio de São Paulo", data: "2023-11-05" },
                    { nome: "Grande Prêmio de Las Vegas", data: "2023-11-18" },
                    { nome: "Grande Prêmio de Abu Dhabi", data: "2023-11-26" }
                ],
                "2024": [
                    { nome: "Grande Prêmio do Bahrein", data: "2024-03-02" },
                    { nome: "Grande Prêmio da Arábia Saudita", data: "2024-03-09" },
                    { nome: "Grande Prêmio da Austrália", data: "2024-03-24" },
                    { nome: "Grande Prêmio do Japão", data: "2024-04-07" },
                    { nome: "Grande Prêmio da China", data: "2024-04-21" },
                    { nome: "Grande Prêmio de Miami", data: "2024-05-05" },
                    { nome: "Grande Prêmio da Emília-Romanha", data: "2024-05-19" },
                    { nome: "Grande Prêmio de Mônaco", data: "2024-05-26" },
                    { nome: "Grande Prêmio do Canadá", data: "2024-06-09" },
                    { nome: "Grande Prêmio da Espanha", data: "2024-06-23" },
                    { nome: "Grande Prêmio da Áustria", data: "2024-06-30" },
                    { nome: "Grande Prêmio da Grã-Bretanha", data: "2024-07-07" },
                    { nome: "Grande Prêmio da Hungria", data: "2024-07-21" },
                    { nome: "Grande Prêmio da Bélgica", data: "2024-07-28" },
                    { nome: "Grande Prêmio dos Países Baixos", data: "2024-08-25" },
                    { nome: "Grande Prêmio da Itália", data: "2024-09-01" },
                    { nome: "Grande Prêmio do Azerbaijão", data: "2024-09-15" },
                    { nome: "Grande Prêmio de Singapura", data: "2024-09-22" },
                    { nome: "Grande Prêmio dos Estados Unidos", data: "2024-10-20" },
                    { nome: "Grande Prêmio do México", data: "2024-10-27" },
                    { nome: "Grande Prêmio de São Paulo", data: "2024-11-03" },
                    { nome: "Grande Prêmio de Las Vegas", data: "2024-11-23" },
                    { nome: "Grande Prêmio do Catar", data: "2024-12-01" },
                    { nome: "Grande Prêmio de Abu Dhabi", data: "2024-12-08" }
                ]
            };

            const temporadaSelect = document.getElementById("temporada");
            const grandePremioSelect = document.getElementById("grandePremio");
            const modal = document.getElementById("gpModal");
            const modalTitle = document.getElementById("gpTitle");
            const modalStats = document.getElementById("gpStats");
            const closeBtn = document.querySelector(".close-btn");

            function preencherGrandesPremios() {
                const temporada = temporadaSelect.value;
                grandePremioSelect.innerHTML = '<option value="">Selecione um Grande Prêmio</option>';
                if (corridas[temporada]) {
                    corridas[temporada].forEach(corrida => {
                        const option = document.createElement("option");
                        option.value = corrida.nome;
                        option.textContent = corrida.nome;
                        grandePremioSelect.appendChild(option);
                    });
                } else {
                    console.error(`Erro: temporada ${temporada} não encontrada.`);
                    alert("Erro ao carregar os Grandes Prêmios. Verifique o console.");
                }
                carregarResultados();
            }

            temporadaSelect.addEventListener("change", preencherGrandesPremios);
            preencherGrandesPremios();

            const adicionarResultadoBtn = document.getElementById("adicionarResultadoBtn");
            adicionarResultadoBtn.addEventListener("click", adicionarResultado);

            async function adicionarResultado() {
                const temporada = temporadaSelect.value;
                const grandePremio = grandePremioSelect.value;
                const posicao = parseInt(document.getElementById("posicao").value);
                let pole = document.getElementById("pole").checked;
                let voltaMaisRapida = document.getElementById("voltaMaisRapida").checked;
                let grandSlam = document.getElementById("grandSlam").checked;
                const titulos = parseInt(document.getElementById("titulos").value) || 0;

                if (!temporada || !grandePremio) {
                    alert("Selecione uma temporada e um Grande Prêmio.");
                    limparFormulario();
                    return;
                }
                if (!posicao || posicao < 1 || posicao > 20) {
                    alert("Insira uma posição válida (1 a 20).");
                    limparFormulario();
                    return;
                }

                if (posicao === 1) {
                    pole = true;
                    voltaMaisRapida = true;
                }

                if (grandSlam && (posicao !== 1 || !pole || !voltaMaisRapida)) {
                    alert("Grand Slam requer 1º lugar, pole position e volta mais rápida.");
                    limparFormulario();
                    return;
                }

                const dadosCorrida = {
                    temporada,
                    grandePremio,
                    data: corridas[temporada].find(c => c.nome === grandePremio).data,
                    posicao,
                    pole,
                    voltaMaisRapida,
                    grandSlam,
                };

                if (!db) {
                    alert("Erro: Banco de dados não inicializado.");
                    limparFormulario();
                    return;
                }

                try {
                    await db.collection("corridas").doc(`${temporada}_${grandePremio}`).set(dadosCorrida);
                    await atualizarEstatisticas(temporada, titulos);
                    alert("Resultado adicionado com sucesso!");
                    carregarResultados();
                    limparFormulario();
                } catch (error) {
                    console.error("Erro ao adicionar resultado:", error);
                    if (error.message.includes("Missing or insufficient permissions")) {
                        alert("Erro: Permissões insuficientes para adicionar resultados. Verifique as permissões no Firestore Console.");
                    } else {
                        alert("Erro ao adicionar resultado: " + error.message);
                    }
                    limparFormulario();
                }
            }

            function limparFormulario() {
                document.getElementById("posicao").value = "";
                document.getElementById("pole").checked = false;
                document.getElementById("voltaMaisRapida").checked = false;
                document.getElementById("grandSlam").checked = false;
                document.getElementById("titulos").value = "";
            }

            async function excluirResultado(temporada, grandePremio) {
                if (!db) {
                    alert("Erro: Banco de dados não inicializado.");
                    return;
                }
                if (confirm(`Deseja excluir o resultado de ${grandePremio} (${temporada})?`)) {
                    try {
                        await db.collection("corridas").doc(`${temporada}_${grandePremio}`).delete();
                        await atualizarEstatisticas(temporada, 0);
                        alert("Resultado excluído com sucesso!");
                        carregarResultados();
                    } catch (error) {
                        console.error("Erro ao excluir resultado:", error);
                        if (error.message.includes("Missing or insufficient permissions")) {
                            alert("Erro: Permissões insuficientes para excluir resultados. Verifique as permissões no Firestore Console.");
                        } else {
                            alert("Erro ao excluir resultado: " + error.message);
                        }
                    }
                }
            }

            async function atualizarEstatisticas(temporada, titulos) {
                if (!db) {
                    alert("Erro: Banco de dados não inicializado.");
                    return;
                }

                try {
                    const corridasSnapshot = await db.collection("corridas").where("temporada", "==", temporada).get();
                    let estatisticas = {
                        corridas: 0,
                        vitorias: 0,
                        podios: 0,
                        poles: 0,
                        voltasMaisRapidas: 0,
                        hatTricks: 0,
                        grandSlams: 0,
                        titulos,
                    };

                    corridasSnapshot.forEach(doc => {
                        const dados = doc.data();
                        estatisticas.corridas++;
                        if (dados.posicao === 1) estatisticas.vitorias++;
                        if (dados.posicao <= 3 && dados.posicao >= 1) estatisticas.podios++;
                        if (dados.pole) estatisticas.poles++;
                        if (dados.voltaMaisRapida) estatisticas.voltasMaisRapidas++;
                        if (dados.posicao === 1 && dados.pole && dados.voltaMaisRapida) estatisticas.hatTricks++;
                        if (dados.grandSlam) estatisticas.grandSlams++;
                    });

                    await db.collection("estatisticas").doc(`temporada_${temporada}`).set(estatisticas);

                    const todasCorridas = await db.collection("corridas").get();
                    let estatisticasCarreira = {
                        corridas: 0,
                        vitorias: 0,
                        podios: 0,
                        poles: 0,
                        voltasMaisRapidas: 0,
                        hatTricks: 0,
                        grandSlams: 0,
                        titulos: 0,
                    };

                    todasCorridas.forEach(doc => {
                        const dados = doc.data();
                        estatisticasCarreira.corridas++;
                        if (dados.posicao === 1) estatisticasCarreira.vitorias++;
                        if (dados.posicao <= 3 && dados.posicao >= 1) estatisticasCarreira.podios++;
                        if (dados.pole) estatisticasCarreira.poles++;
                        if (dados.voltaMaisRapida) estatisticasCarreira.voltasMaisRapidas++;
                        if (dados.posicao === 1 && dados.pole && dados.voltaMaisRapida) estatisticasCarreira.hatTricks++;
                        if (dados.grandSlam) estatisticasCarreira.grandSlams++;
                    });

                    const temporadas = ["2023", "2024"];
                    for (const temp of temporadas) {
                        const temporadaDoc = await db.collection("estatisticas").doc(`temporada_${temp}`).get();
                        if (temporadaDoc.exists) {
                            estatisticasCarreira.titulos += temporadaDoc.data().titulos || 0;
                        }
                    }

                    await db.collection("estatisticas").doc("carreira").set(estatisticasCarreira);
                } catch (error) {
                    console.error("Erro ao atualizar estatísticas:", error);
                    if (error.message.includes("Missing or insufficient permissions")) {
                        alert("Erro: Permissões insuficientes para atualizar estatísticas. Verifique as permissões no Firestore Console.");
                    } else {
                        alert("Erro ao atualizar estatísticas: " + error.message);
                    }
                }
            }

            async function mostrarEstatisticasGP(grandePremio) {
                if (!db) {
                    alert("Erro: Banco de dados não inicializado.");
                    return;
                }

                try {
                    const corridasSnapshot = await db.collection("corridas").where("grandePremio", "==", grandePremio).get();
                    let stats = {
                        corridas: 0,
                        vitorias: 0,
                        podios: 0,
                        poles: 0,
                        voltasMaisRapidas: 0,
                        hatTricks: 0,
                        grandSlams: 0,
                    };

                    corridasSnapshot.forEach(doc => {
                        const dados = doc.data();
                        stats.corridas++;
                        if (dados.posicao === 1) stats.vitorias++;
                        if (dados.posicao <= 3 && dados.posicao >= 1) stats.podios++;
                        if (dados.pole) stats.poles++;
                        if (dados.voltaMaisRapida) stats.voltasMaisRapidas++;
                        if (dados.posicao === 1 && dados.pole && dados.voltaMaisRapida) stats.hatTricks++;
                        if (dados.grandSlam) stats.grandSlams++;
                    });

                    modalTitle.innerHTML = countryFlags[grandePremio]
                        ? `<img src="${countryFlags[grandePremio]}" class="gp-flag" alt="Bandeira do GP"> ${grandePremio}`
                        : grandePremio;
                    modalStats.innerHTML = `
                        <p><i class="fas fa-flag-checkered"></i> Corridas: ${stats.corridas}</p>
                        <p><i class="fas fa-trophy"></i> Vitórias: ${stats.vitorias}</p>
                        <p><i class="fas fa-star"></i> Pódios: ${stats.podios}</p>
                        <p><i class="fas fa-tachometer-alt"></i> Pole Positions: ${stats.poles}</p>
                        <p><i class="fas fa-stopwatch"></i> Voltas Mais Rápidas: ${stats.voltasMaisRapidas}</p>
                        <p><i class="fas fa-medal"></i> Hat-tricks: ${stats.hatTricks}</p>
                        <p><i class="fas fa-crown"></i> Grand Slams: ${stats.grandSlams}</p>
                    `;
                    modal.style.display = "flex";
                } catch (error) {
                    console.error("Erro ao carregar estatísticas do GP:", error);
                    alert("Erro ao carregar estatísticas do GP: " + error.message);
                }
            }

            closeBtn.addEventListener("click", () => {
                modal.style.display = "none";
            });

            window.addEventListener("click", (event) => {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });

            async function carregarResultados() {
                if (!db) {
                    alert("Erro: Banco de dados não inicializado.");
                    return;
                }

                const temporada = temporadaSelect.value;
                const resultadosBody = document.getElementById("resultadosBody");
                resultadosBody.innerHTML = '<tr><td colspan="8">Carregando...</td></tr>';

                try {
                    const corridasSnapshot = await db.collection("corridas").where("temporada", "==", temporada).orderBy("data").get();

                    resultadosBody.innerHTML = "";
                    corridasSnapshot.forEach(doc => {
                        const dados = doc.data();
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${dados.temporada}</td>
                            <td><img src="${countryFlags[dados.grandePremio] || ''}" class="flag" alt="Bandeira"> ${dados.grandePremio}</td>
                            <td>${dados.data}</td>
                            <td>${dados.posicao}</td>
                            <td>${dados.pole ? "Sim" : "Não"}</td>
                            <td>${dados.voltaMaisRapida ? "Sim" : "Não"}</td>
                            <td>${dados.grandSlam ? "Sim" : "Não"}</td>
                            <td><button class="delete-btn"><i class="fas fa-trash"></i> Excluir</button></td>
                        `;
                        resultadosBody.appendChild(row);

                        row.addEventListener("click", (e) => {
                            if (!e.target.closest(".delete-btn")) {
                                mostrarEstatisticasGP(dados.grandePremio);
                            }
                        });

                        const deleteBtn = row.querySelector(".delete-btn");
                        deleteBtn.addEventListener("click", () => excluirResultado(dados.temporada, dados.grandePremio));
                    });

                    const statsDoc = await db.collection("estatisticas").doc(`temporada_${temporada}`).get();
                    const statsDiv = document.getElementById("statsTemporada");
                    if (statsDoc.exists) {
                        const stats = statsDoc.data();
                        statsDiv.innerHTML = `
                            <h3>Temporada ${temporada}</h3>
                            <p><i class="fas fa-flag-checkered"></i> Corridas: ${stats.corridas}</p>
                            <p><i class="fas fa-trophy"></i> Vitórias: ${stats.vitorias}</p>
                            <p><i class="fas fa-star"></i> Pódios: ${stats.podios}</p>
                            <p><i class="fas fa-tachometer-alt"></i> Pole Positions: ${stats.poles}</p>
                            <p><i class="fas fa-stopwatch"></i> Voltas Mais Rápidas: ${stats.voltasMaisRapidas}</p>
                            <p><i class="fas fa-medal"></i> Hat-tricks: ${stats.hatTricks}</p>
                            <p><i class="fas fa-crown"></i> Grand Slams: ${stats.grandSlams}</p>
                            <p><i class="fas fa-award"></i> Títulos: ${stats.titulos}</p>
                        `;
                    } else {
                        statsDiv.innerHTML = `<h3>Temporada ${temporada}</h3><p>Sem dados disponíveis.</p>`;
                    }

                    const carreiraDoc = await db.collection("estatisticas").doc("carreira").get();
                    const carreiraStatsDiv = document.getElementById("carreiraStats");
                    if (carreiraDoc.exists) {
                        const stats = carreiraDoc.data();
                        carreiraStatsDiv.innerHTML = `
                            <h3>Carreira</h3>
                            <p><i class="fas fa-flag-checkered"></i> Corridas: ${stats.corridas}</p>
                            <p><i class="fas fa-trophy"></i> Vitórias: ${stats.vitorias}</p>
                            <p><i class="fas fa-star"></i> Pódios: ${stats.podios}</p>
                            <p><i class="fas fa-tachometer-alt"></i> Pole Positions: ${stats.poles}</p>
                            <p><i class="fas fa-stopwatch"></i> Voltas Mais Rápidas: ${stats.voltasMaisRapidas}</p>
                            <p><i class="fas fa-medal"></i> Hat-tricks: ${stats.hatTricks}</p>
                            <p><i class="fas fa-crown"></i> Grand Slams: ${stats.grandSlams}</p>
                            <p><i class="fas fa-award"></i> Títulos Mundiais: ${stats.titulos}</p>
                        `;
                    } else {
                        carreiraStatsDiv.innerHTML = "<h3>Carreira</h3><p>Sem dados disponíveis.</p>";
                    }
                } catch (error) {
                    console.error("Erro ao carregar resultados:", error);
                    if (error.message.includes("The query requires an index")) {
                        alert("Erro: É necessário criar um índice no Firestore. Acesse o Firebase Console > Firestore > Índices e crie um índice composto para 'temporada' (ascendente) e 'data' (ascendente) na coleção 'corridas'.");
                    } else if (error.message.includes("Missing or insufficient permissions")) {
                        alert("Erro: Permissões insuficientes para carregar resultados. Verifique as permissões no Firestore Console.");
                    } else {
                        alert("Erro ao carregar resultados: " + error.message);
                    }
                    resultadosBody.innerHTML = '<tr><td colspan="8">Erro ao carregar resultados.</td></tr>';
                }
            }

            carregarResultados();
        });
    </script>
</body>
</html>

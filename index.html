<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estatísticas de F. Lapa - F1</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos mantidos iguais ao original */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0a0a14, #1e2a2e), url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"%3E%3Cpath fill="%232a2a3a" fill-opacity="0.1" d="M0 0h10v10H0zM10 10h10v10H10z"/%3E%3C/svg%3E');
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            color: #ff2d55;
            text-shadow: 0 0 15px rgba(255, 45, 85, 0.8);
            font-size: 2.8em;
            margin-bottom: 40px;
            letter-spacing: 3px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .flag-br {
            width: 32px;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .f1-logo {
            width: 60px;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        .form-container {
            background: rgba(20, 20, 30, 0.95);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7), inset 0 0 12px rgba(255, 45, 85, 0.3);
            margin-bottom: 40px;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .form-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8), inset 0 0 15px rgba(255, 45, 85, 0.4);
        }

        .form-container h2 {
            font-family: 'Orbitron', sans-serif;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.7);
            margin-bottom: 20px;
            font-size: 1.6em;
        }

        .form-container select, .form-container input[type="number"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            background: rgba(40, 40, 50, 0.9);
            color: #e0e0e0;
            transition: all 0.3s ease;
        }

        .form-container select:focus, .form-container input[type="number"]:focus {
            background: rgba(50, 50, 60, 0.9);
            box-shadow: 0 0 10px rgba(255, 45, 85, 0.5);
            outline: none;
        }

        .form-container label {
            margin: 10px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #b0b0b0;
        }

        .form-container button {
            background: linear-gradient(45deg, #ff2d55, #ff6b6b);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .form-container button:hover {
            background: linear-gradient(45deg, #e91e63, #ff5252);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 45, 85, 0.7);
        }

        .table-container {
            background: rgba(20, 20, 30, 0.95);
            border-radius: 16px;
            overflow-x: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            margin-bottom: 40px;
            backdrop-filter: blur(8px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #e0e0e0;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        th {
            background: linear-gradient(45deg, #ff2d55, #ff6b6b);
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
        }

        tr {
            transition: all 0.3s ease;
        }

        tr:nth-child(even) {
            background: rgba(40, 40, 50, 0.5);
        }

        tr:hover {
            background: rgba(60, 60, 70, 0.7);
            transform: translateX(5px);
        }

        .flag {
            width: 24px;
            vertical-align: middle;
            margin-right: 8px;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .delete-btn {
            background: linear-gradient(45deg, #e91e63, #ff5252);
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: linear-gradient(45deg, #c2185b, #d81b60);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 45, 85, 0.7);
        }

        .delete-btn i {
            margin-right: 5px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stats-card {
            background: rgba(20, 20, 30, 0.95);
            color: #e0e0e0;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7), inset 0 0 12px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            animation: slideIn 0.5s ease-out;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8), inset 0 0 15px rgba(0, 212, 255, 0.4);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-card h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.7);
            margin-bottom: 15px;
            font-size: 1.6em;
            text-transform: uppercase;
        }

        .stats-card p {
            margin: 10px 0;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-card p i {
            color: #ff2d55;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            h1 {
                font-size: 2.2em;
                margin-bottom: 30px;
            }

            .flag-br {
                width: 28px;
            }

            .f1-logo {
                width: 50px;
            }

            .form-container, .stats-card {
                padding: 20px;
            }

            .form-container select, .form-container input[type="number"] {
                font-size: 13px;
            }

            .form-container label {
                font-size: 13px;
            }

            .form-container button {
                font-size: 13px;
                padding: 10px;
            }

            th, td {
                padding: 10px;
                font-size: 12px;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .flag-br {
                width: 24px;
            }

            .f1-logo {
                width: 40px;
            }

            .form-container, .stats-card {
                padding: 15px;
            }

            .form-container h2, .stats-card h3 {
                font-size: 1.3em;
            }

            th, td {
                padding: 8px;
                font-size: 11px;
            }

            .flag {
                width: 20px;
            }

            .delete-btn {
                padding: 6px 10px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <img src="https://flagcdn.com/w20/br.png" class="flag-br" alt="Bandeira do Brasil">
            Estatísticas de F. Lapa - F1
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/33/F1.svg" class="f1-logo" alt="Fórmula 1 Logo">
        </h1>
        <div class="form-container">
            <h2><i class="fas fa-flag-checkered"></i> Adicionar Resultado de Corrida</h2>
            <select id="temporada">
                <option value="2023">2023</option>
                <option value="2024" selected>2024</option>
            </select>
            <select id="grandePremio"></select>
            <input type="number" id="posicao" placeholder="Posição (1-20)" min="1" max="20">
            <label><input type="checkbox" id="pole"> <i class="fas fa-tachometer-alt"></i> Pole Position</label>
            <label><input type="checkbox" id="voltaMaisRapida"> <i class="fas fa-stopwatch"></i> Volta Mais Rápida</label>
            <label><input type="checkbox" id="grandSlam"> <i class="fas fa-trophy"></i> Grand Slam</label>
            <input type="number" id="titulos" placeholder="Títulos Mundiais (Manual)" min="0">
            <button id="adicionarResultadoBtn"><i class="fas fa-plus-circle"></i> Adicionar Resultado</button>
        </div>
        <h2><i class="fas fa-list"></i> Resultados das Corridas</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Temporada</th>
                        <th>Grande Prêmio</th>
                        <th>Data</th>
                        <th>Posição</th>
                        <th>Pole</th>
                        <th>Volta Mais Rápida</th>
                        <th>Grand Slam</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="resultadosBody"></tbody>
            </table>
        </div>
        <h2><i class="fas fa-chart-bar"></i> Estatísticas</h2>
        <div class="stats-container">
            <div class="stats-card" id="statsTemporada"></div>
            <div class="stats-card" id="carreiraStats"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const firebaseConfig = {
                apiKey: "AIzaSyAuutbwYf0ZHatqPGFJCweAmWHq84x9zac",
                authDomain: "formula-1-4d935.firebaseapp.com",
                projectId: "formula-1-4d935",
                storageBucket: "formula-1-4d935.firebasestorage.app",
                messagingSenderId: "451569681777",
                appId: "1:451569681777:web:4bfcc9d590d480965c22d0",
                measurementId: "G-2JTBM17G1T"
            };

            let db;
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log("Firebase inicializado com sucesso.");
            } catch (error) {
                console.error("Erro ao inicializar Firebase:", error);
                alert("Erro ao conectar com o banco de dados. Verifique o console.");
            }

            const countryFlags = {
                "Grande Prêmio do Bahrein": "https://flagcdn.com/w20/bh.png",
                "Grande Prêmio da Arábia Saudita": "https://flagcdn.com/w20/sa.png",
                "Grande Prêmio da Austrália": "https://flagcdn.com/w20/au.png",
                "Grande Prêmio do Azerbaijão": "https://flagcdn.com/w20/az.png",
                "Grande Prêmio de Miami": "https://flagcdn.com/w20/us.png",
                "Grande Prêmio de Mônaco": "https://flagcdn.com/w20/mc.png",
                "Grande Prêmio da Espanha": "https://flagcdn.com/w20/es.png",
                "Grande Prêmio do Canadá": "https://flagcdn.com/w20/ca.png",
                "Grande Prêmio da Áustria": "https://flagcdn.com/w20/at.png",
                "Grande Prêmio da Grã-Bretanha": "https://flagcdn.com/w20/gb.png",
                "Grande Prêmio da Hungria": "https://flagcdn.com/w20/hu.png",
                "Grande Prêmio da Bélgica": "https://flagcdn.com/w20/be.png",
                "Grande Prêmio dos Países Baixos": "https://flagcdn.com/w20/nl.png",
                "Grande Prêmio da Itália": "https://flagcdn.com/w20/it.png",
                "Grande Prêmio de Singapura": "https://flagcdn.com/w20/sg.png",
                "Grande Prêmio do Japão": "https://flagcdn.com/w20/jp.png",
                "Grande Prêmio do Catar": "https://flagcdn.com/w20/qa.png",
                "Grande Prêmio dos Estados Unidos": "https://flagcdn.com/w20/us.png",
                "Grande Prêmio do México": "https://flagcdn.com/w20/mx.png",
                "Grande Prêmio de São Paulo": "https://flagcdn.com/w20/br.png",
                "Grande Prêmio de Las Vegas": "https://flagcdn.com/w20/us.png",
                "Grande Prêmio de Abu Dhabi": "https://flagcdn.com/w20/ae.png",
                "Grande Prêmio da China": "https://flagcdn.com/w20/cn.png",
                "Grande Prêmio da Emília-Romanha": "https://flagcdn.com/w20/it.png"
            };

            const corridas = {
                "2023": [
                    { nome: "Grande Prêmio do Bahrein", data: "2023-03-05" },
                    { nome: "Grande Prêmio da Arábia Saudita", data: "2023-03-19" },
                    { nome: "Grande Prêmio da Austrália", data: "2023-04-02" },
                    { nome: "Grande Prêmio do Azerbaijão", data: "2023-04-30" },
                    { nome: "Grande Prêmio de Miami", data: "2023-05-07" },
                    { nome: "Grande Prêmio de Mônaco", data: "2023-05-28" },
                    { nome: "Grande Prêmio da Espanha", data: "2023-06-04" },
                    { nome: "Grande Prêmio do Canadá", data: "2023-06-18" },
                    { nome: "Grande Prêmio da Áustria", data: "2023-07-02" },
                    { nome: "Grande Prêmio da Grã-Bretanha", data: "2023-07-09" },
                    { nome: "Grande Prêmio da Hungria", data: "2023-07-23" },
                    { nome: "Grande Prêmio da Bélgica", data: "2023-07-30" },
                    { nome: "Grande Prêmio dos Países Baixos", data: "2023-08-27" },
                    { nome: "Grande Prêmio da Itália", data: "2023-09-03" },
                    { nome: "Grande Prêmio de Singapura", data: "2023-09-17" },
                    { nome: "Grande Prêmio do Japão", data: "2023-09-24" },
                    { nome: "Grande Prêmio do Catar", data: "2023-10-08" },
                    { nome: "Grande Prêmio dos Estados Unidos", data: "2023-10-22" },
                    { nome: "Grande Prêmio do México", data: "2023-10-29" },
                    { nome: "Grande Prêmio de São Paulo", data: "2023-11-05" },
                    { nome: "Grande Prêmio de Las Vegas", data: "2023-11-18" },
                    { nome: "Grande Prêmio de Abu Dhabi", data: "2023-11-26" }
                ],
                "2024": [
                    { nome: "Grande Prêmio do Bahrein", data: "2024-03-02" },
                    { nome: "Grande Prêmio da Arábia Saudita", data: "2024-03-09" },
                    { nome: "Grande Prêmio da Austrália", data: "2024-03-24" },
                    { nome: "Grande Prêmio do Japão", data: "2024-04-07" },
                    { nome: "Grande Prêmio da China", data: "2024-04-21" },
                    { nome: "Grande Prêmio de Miami", data: "2024-05-05" },
                    { nome: "Grande Prêmio da Emília-Romanha", data: "2024-05-19" },
                    { nome: "Grande Prêmio de Mônaco", data: "2024-05-26" },
                    { nome: "Grande Prêmio do Canadá", data: "2024-06-09" },
                    { nome: "Grande Prêmio da Espanha", data: "2024-06-23" },
                    { nome: "Grande Prêmio da Áustria", data: "2024-06-30" },
                    { nome: "Grande Prêmio da Grã-Bretanha", data: "2024-07-07" },
                    { nome: "Grande Prêmio da Hungria", data: "2024-07-21" },
                    { nome: "Grande Prêmio da Bélgica", data: "2024-07-28" },
                    { nome: "Grande Prêmio dos Países Baixos", data: "2024-08-25" },
                    { nome: "Grande Prêmio da Itália", data: "2024-09-01" },
                    { nome: "Grande Prêmio do Azerbaijão", data: "2024-09-15" },
                    { nome: "Grande Prêmio de Singapura", data: "2024-09-22" },
                    { nome: "Grande Prêmio dos Estados Unidos", data: "2024-10-20" },
                    { nome: "Grande Prêmio do México", data: "2024-10-27" },
                    { nome: "Grande Prêmio de São Paulo", data: "2024-11-03" },
                    { nome: "Grande Prêmio de Las Vegas", data: "2024-11-23" },
                    { nome: "Grande Prêmio do Catar", data: "2024-12-01" },
                    { nome: "Grande Prêmio de Abu Dhabi", data: "2024-12-08" }
                ]
            };

            const temporadaSelect = document.getElementById("temporada");
            const grandePremioSelect = document.getElementById("grandePremio");

            function preencherGrandesPremios() {
                const temporada = temporadaSelect.value;
                grandePremioSelect.innerHTML = '<option value="">Selecione um Grande Prêmio</option>';
                if (corridas[temporada]) {
                    corridas[tempo].forEach(corrida => {
                        const option = document.createElement("option");
                        option.value = corrida.nome;
                        option.textContent = corrida.nome;
                        grandePremioSelect.appendChild(option);
                    });
                } else {
                    console.error("Erro: Temporada ${temporada} não encontrada.");
                    alert("Erro ao carregar os Grandes Prêmios. Verifique o console.");
                }
                carregarResultados();
            }

            temporadaSelect.addEventListener("change", preencherGrandesPremios);
            preencherGrandesPremios();

            const adicionarResultadoBtn = document.getElementById("adicionarResultadoBtn");
            adicionarResultadoBtn.addEventListener("click", adicionarResultado);

            async function adicionarResultado() {
                const temporada = temporadaSelect.value;
                const grandePremio = grandePremioSelect.value;
                const posicao = parseInt(document.getElementById("posicao").value);
                let pole = document.getElementById("pole").checked;
                let voltaMaisRapida = document.getElementById("voltaMaisRapida.checked;
                let grandSlam = document.getElementById("grandSlam").checked;
                const titulos = parseInt(document.getElementById("titulos").value) || 0;

                if (!temporada || !grandePremio) {
                    alert("Selecione uma temporada e um Grande Prêmio.");
                    return;
                }
                if (!posicao || posicao < 1 || posicao > 20) {
                    alert("Insira uma posição válida (1 a 20).");
                    return;
                }

                if (posicao === 1) {
                    pole = true;
                    voltaMaisRapida = true;
                }

                if (grandSlam && (posicao !== 1 || !pole || !voltaMaisRapida)) {
                    alert("Grand Slam requer 1º lugar, pole position e volta mais rápida.");
                    return;
                }

                const dadosCorrida = {
                    temporada,
                    grandePremio,
                    data: corridas[temporada].find(c => c.nome === grandePremio).data,
                    posicao,
                    pole,
                    voltaMaisRapida,
                    grandSlam
                };

                if (!db) {
                    alert("Erro: Banco de dados não inicializado.");
                    return;
                }

                try {
                    await db.collection("corridas").doc(`${temporada}_${grandePremio}`).set(dadosCorrida);
                    await atualizarEstatisticas(temporada, titulos);
                    alert("Resultado adicionado com sucesso!");
                    carregarResultados();
                    document.getElementById("posicao").value = "";
                    document.getElementById("pole").checked = false;
                    document.getElementById("voltaMaisRapida").checked = false;
                    document.getElementById("grandSlam").checked = false;
                    document.getElementById("titulos").value = "";
                } catch (error) {
                    console.error("Erro ao adicionar resultado:", error);
                    alert("Erro ao adicionar resultado. Verifique o console para mais detalhes.");
                }
            }

            async function excluirResultado(temporada, grandePremio) {
                if (!db) return;
                if (confirm(`Deseja excluir o resultado de ${grandePremio} (${temporada})?`)) {
                    try {
                        await db.collection("corridas").doc(`${temporada}_${grandePremio}`).delete();
                        await atualizarEstatisticas(temporada, 0);
                        alert("Resultado excluído com sucesso!");
                        carregarResultados();
                    } catch (error) {
                        console.error("Erro ao excluir resultado:", error);
                        alert("Erro ao excluir resultado. Verifique o console para mais detalhes.");
                    }
                }
            }

            async function atualizarEstatisticas(temporada, titulos) {
                if (!db) return;

                const corridasSnapshot = await db.collection("corridas").where("temporada", "==", temporada).get();
                let estatisticas = {
                    corridas: 0,
                    vitorias: 0,
                    podios: 0,
                    poles: 0,
                    voltasMaisRapidas: 0,
                    hatTricks: 0,
                    grandSlams: 0,
                    titulos
                };

                corridasSnapshot.forEach(doc => {
                    const dados = doc.data();
                    estatisticas.corridas++;
                    if (dados.posicao === 1) estatisticas.vitorias++;
                    if (dados.posicao <= 3 && dados.posicao >= 1) estatisticas.podios++;
                    if (dados.pole) estatisticas.poles++;
                    if (dados.voltaMaisRapida) estatisticas.voltasMaisRapidas++;
                    if (dados.posicao === 1 && dados.pole && dados.voltaMaisRapida) estatisticas.hatTricks++;
                    if (dados.grandSlam) estatisticas.grandSlams++;
                });

                await db.collection("estatisticas").doc(`temporada_${temporada}`).set(estatistica);
                const todasCorridas = await db.collection("corridas").get();
                let estatísticasCarreira = {
                    corridas: 0,
                    pontos: 0,
                    vitorias: 0,
                    podios: 0,
                    poles: 0,
                    voltasMaisRapidas: 0,
                    hatTricks: 0,
                    grandSlams: 0,
                    titulos: 0,
                };

                todasCorridas.forEach(doc => {
                    const dados = doc.data();
                    estatísticasCarreira.corridas++;
                    if (dados.posicao === 1) estatísticasCarreira.vitorias++;
                    if (dados.posicao <= 3 && dados.posicao >= 1) estatísticasCarreira.podios++;
                    if (dados.pole) estatísticasCarreira.poles++;
                    if (dados.voltaMaisRapida) estatísticasCarreira.voltasMaisRapidas++;
                    if (dados.posicao === 1 && dados.pole && dados.voltaMaisRapida) estatísticasCarreira.hatTricks++;
                    if (dados.grandSlam) estatísticasCarreira.grandSlams++;
                });

                const temporadas = ["2023", "2024"];
                for (const temp of temporadas) {
                    const temporadaDoc = await db.collection("estatísticas").doc(`temporada_${temp}`).get();
                    if (temporadaDoc.exists) {
                        estatísticasCarreira.titulos += temporadaDoc.data().titulos || 0;
                    }
                }

                await db.collection("estatísticas").doc("carreira").set(estatísticasCarreira);
            }

            async function carregarResultados() {
                if (!db) {
                    alert("Erro: Banco de dados não inicializado!");
                    return;
                }

                const temporada = temporadaSelect.value;
                const resultadosBody = document.getElementById("resultadosBody");
                resultadosBody.innerHTML = "<tr><td colspan="8">Carregando...</td></tr>";

                try {
                    const corridasSnapshot = await db.collection("corridas")
                    .where("temporada", "==", temporada)
                    .orderBy("data")
                    .get();

                    resultadosBody.innerHTML = "";
                    corridasSnapshot.forEach(doc => {
                        const dados = doc.data();
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${dados.temporada}</td>
                            <td><img src="${countryFlags[dados.grandePremio]}" class="flag" alt="Flag"> ${dados.grandePremio}</td>
                            <td>${dados.data}</td>
                            <td>${dados.posicao}</td>
                            <td>${dados.pole ? "Sim" : "Não"}</td>
                            <td>${dados.voltaMaisRapida ? "Sim" : "Não"}</td>
                            <td>${dados.grandSlam ? "Sim" : "Não"}</td>
                            <td><button class="delete-btn"><i class="fas fa-trash"></i> Excluir</button></td>
                        `;
                        resultadosBody.appendChild(row);
                        const deleteBtn = row.querySelector(".delete-btn");
                        deleteBtn.addEventListener("click", () => excluirResultado(dados.temporada, dados.grandePremio));
                    });

                    const statsDoc = await db.collection("estatísticas").doc(`temporada_${temporada}`).get();
                    const statsDiv = document.getElementById("statsTemporada");
                    if (statsDiv.exists) {
                        const stats = statsDoc.data();
                        statsDiv.innerHTML = `
                            <h3>Temporada ${temporada}</h3>
                            <p><i class="fas fa-flag-checkered"></i> Corridas: ${stats.corridas}</p>
                            <p><i class="fas fa-trophy"></i> Vitórias: ${stats.vitorias}</p>
                            <p><i class="fas fa-podium"></i> Pódios: ${stats.podios}</p>
                            <p><i class="fas fa-tachometer-alt"></i> Poles: ${stats.poles}</p>
                            <p><i class="fas fa-stopwatch"></i> Voltas Mais Rápidas: ${stats.voltasMaisRapidas}</p>
                            <p><i class="fas fa-medal"></i> Hat-tricks: ${stats.hatTricks}</p>
                            <p><i class="fas fa-crown"></i> Grand Slams: ${stats.grandSlams}</p>
                            <p><i class="fas fa-award"></i> Títulos: ${stats.titulos}</p>
                        `;
                    } else {
                        statsDiv.innerHTML = `<h3>Temporada ${temporada}</h3><p>Sem dados disponíveis.</p>`;
                    }

                    const carreiraDoc = await db.collection("estatísticas").doc("carreira").get();
                    const carreiraStatsDiv = document.getElementById("carreiraStats");
                    if (carreiraDoc.exists) {
                        const stats = carreiraDoc.data();
                        carreiraStatsDiv.innerHTML = `
                            <h3>Carreira</h3>
                            <p><i class="fas fa-flag-checkered"></i> Corridas: ${stats.corridas}</p>
                            <p><i class="fas fa-trophy"></i> Vitórias: ${stats.vitorias}</p>
                            <p><i class="fas fa-podium"></i> Pódios: ${stats.podios}</p>
                            <p><i class="fas fa-tachometer-alt"></i> Poles: ${stats.poles}</p>
                            <p><i class="fas fa-stopwatch"></i> Voltas Mais Rápidas: ${stats.voltasMaisRapidas}</p>
                            <p><i class="fas fa-medal"></i> Hat-tricks: ${stats.hatTricks}</p>
                            <p><i class="fas fa-crown"></i> Grand Slams: ${stats.grandSlams}</p>
                            <p><i class="fas fa-award"></i> Títulos: ${stats.titulos}</p>
                        `;
                    } else {
                        carreiraStatsDiv.innerHTML = "<h3>Carreira</h3><p>Sem dados disponíveis.</p>";
                    }
                } catch (error) {
                    console.error("Erro ao carregar resultados:", error);
                    if (error.message.includes("The query requires an index")) {
                        alert("Erro: É necessário criar um índice no Firestore. Acesse o link fornecido no console ou vá até o Firebase Console > Firestore > Indexes e crie um índice composto para 'temporada' (ascendente) e 'data' (ascendente) na coleção 'corridas'.");
                    } else if (error.message.includes("Missing or insufficient permissions")) {
                        alert("Erro: Permissões insuficientes para carregar resultados. Verifique as regras de segurança no Firebase Console.");
                    } else {
                        alert("Erro ao carregar resultados. Verifique o console para mais detalhes.");
                    }
                    resultadosBody.innerHTML = '<tr><td colspan="8">Erro ao carregar resultados.</td></tr>';
                }
            }

            carregarResultados();
        });
    </script>
</body>
</html>
